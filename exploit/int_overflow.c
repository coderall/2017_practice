/*************************************************************************
# File Name:    int_overflow.c
# Author:     alan
# mail:       lzcgwushuang@163.com
# Created Time: Fri 12 May 2017 03:18:07 AM PDT
 ************************************************************************/

/* Thanks diting0X and http://www.csyssec.org/20161230/integerflow/   */

#include<stdio.h>
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
void store_passwd_indb(char* passwd)
{
}
void validate_uname(char* uname)
{
}

// you need some long enough string including the shellcode
void validate_passwd(char* passwd)
{
    char passwd_buf[11];
    /* 
     * here strlen's return value will overflow the passwd_len and pass the 
     * len check and then strcpy may incur the stack overflow
     * */
    unsigned char passwd_len = strlen(passwd); /* [1] */
    if(passwd_len >= 4 && passwd_len <= 8)   /* [2] */
    {
        printf("Valid Password\n"); /* [3] */
        fflush(stdout);
        strcpy(passwd_buf,passwd); /* [4] */
    }
    else
    {
        printf("Invalid Password\n"); /* [5] */
        fflush(stdout);
    }
    store_passwd_indb(passwd_buf); /* [6] */
}
int main(int argc, char* argv[])
{
    if(argc!=3)
    {
        printf("Usage Error:   \n");
        fflush(stdout);
        exit(-1);
    }
    validate_uname(argv[1]);
    validate_passwd(argv[2]);
    return 0;
}
