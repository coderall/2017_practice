--- 内核相关面试题目汇总 ---

// CPU 调度&进程管理

1、简单介绍下 O(1)调度算法

2、简单介绍下CFS算法，和O(1)算法的不同之处在哪

3、什么是IDT，有什么用

4、中断处理 和 内核态调用 哪个优先级高，为什么？

5、IPI是什么，有什么用？

6、pthread_mutex 默认情况下 对同一个锁 重复加锁两次 会有什么效果，为什么？

7、pthread_mutex 怎么实现？ 使用了哪个系统调用？

8、可以在线程中调用fork吗？为什么？

9、内核是怎么处理僵尸进程的？

10、ps的命令中，怎么知道哪个是内核线程(一般情况下)，内核线程又是怎么实现的？

11、在内核中，怎么获取当前进程的 task_struct 结构？

12、为什么在spinlock的临界区中不能睡眠？

13、为什么在中断处理程序中不能睡眠？

14、内核中使用较多的锁都有哪些？作用都有哪些？

15、简单解释下RCU？

16、解释下uptime命令的输出？具体的计算依据是什么？（CPU run queue中 进程和处于D状态的进程数量）

17、nice命令的作用有哪些？

18、进程的静态优先级和动态优先级的概念？

19、top 命令输出中 hi 列 si 列 分别代表什么？

20、mpstat 或者 sar 命令中 steal% 列代表什么意思？

21、解释下bogomips？

22、内核中表示时钟中断频率的常量值是哪个？在命令行中怎么查看？

23、后台服务器和桌面系统的时钟中断频率值有什么差别？为什么要这样设置？

24、chrt 作用有哪些？

25、简单解释下 CFS 调度算法中的vruntime概念？

26、fork 调用后 父进程先执行还是子进程先执行？

27、解释下 sched_yield 函数？

28、怎样查看系统是否支持cgroup？

29、怎样避免程序被调试执行（安全相关）？
    tips：PTRACE_TRACEME & SIGTRAP handler & /proc/self/status
 
30、简单解释下 vsyscall & vdso ？

31、/proc/kcore文件有什么用？

32、/proc/kallsyms文件有什么用？

33、linux的线程实现方式？

34、简单描述下线程组中接收到信号的处理？

35、task_struct结构中pid，tgid的作用？

36、getpid(),gettid()实现？
   (tips:getpid其实取的值是tgid，gettid取的值是pid，有点绕。其实还是和LWP的实现方式相关)
   
37、pthread_self() 又是怎么实现的呢？和上面两个函数的区别和联系分别是什么？

38、top命令显示中S列代表什么？"I"表示什么状态？

39、什么是内核抢占？在多核系统中怎么定义？

40、preempt_enable是一个抢占点吗？为什么？
	（tips：在preemt_enable函数中，会尝试抢占执行，具体参考源码实现）

41、sysenter和sysexit指令实现了什么功能？

42、SCHED_FIFO SCHED_RR SCHED_NORMAL 三种调度策略有什么区别？

43、什么是DMA？

44、什么是RDMA？

45、什么是IPI？有什么作用？

46、CFS中通过什么方法来避免fork出的新进程总是优先于其他进程执行？

47、CFS算法中怎样保证长时间睡眠的进程被唤醒时（vruntime很小），不至于长时间占用CPU？

48、CFS算法中，进程从一个CPU上迁移到另一个CPU，对应的vruntime会不会变？为什么要这样做？

49、系统中最大进程数由什么控制？
    （tips：之前的设计中，进程数量还受到GDT表项的限制，但现在没有这个问题了）

50、pread和pwrite在哪种场合下使用较多？
    （tips：因为pread和pwrite的操作不修改对应fd的offset，所以在多线程读写方面有优势）

51、access_ok 宏有什么作用？

52、链接静态库时，单个.o文件中未引用的部分的优化方式是什么？

53、什么是LLC cache？

54、Intel 的 Skylake 和 Broadwell架构有什么区别，带来了什么影响？

55、spinlock怎么实现？（考虑多核情况）
	（tips：当前内核中采用ticket-based算法来实现）
	
56、Linux现在的实现中中断允许嵌套吗？为什么？

57、当内核现在正处于中断处理上半部时，后面来的中断怎么处理？丢掉还是？
	（tips：pengding）

58、怎样禁止 ping 请求？
	（tips： echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all）
	
59、系统重启后上述的禁止 ping 会失效，怎么解决？
	(tips： 在 /etc/sysctl.conf文件中添加 net.ipv4.conf.icmp_echo_ignore_all=1)
	
60、nice值在 O(1) 和 CFS 算法中有什么不同的含义？

61、oops 和 panic 一样吗？
	(tips：不一样，在硬中断或软中断中，如果oops，那么肯定panic，即内核崩溃，如果是在进程上下文中，那么发送SIGSEGV信号，如果配置了oops_on_panic选项为1，那么在oops中内核也会崩溃。总结就是 oops 不一定会引起 内核 panic)
	
62、write被中断打断后，会返回什么？ERRNO又会是什么？
	(tips：尤其是在处理网络请求时要注意)

// 内存管理

1、malloc的实现

2、简单介绍下 tcmalloc 或 jemalloc 或 ptmalloc

3、简单介绍下 buddy system

4、简单介绍下 slab

5、内核初始化时使用的内存分配算法是什么？

6、内核的一级页表和二级页表分别存放在哪里？

7、slab是怎样避免内存碎片的？

8、slab分配的是物理内存还是虚拟内存？

9、buddy system 分配的是物理内存还是虚拟内存？

10、简单解释下slab着色？

11、匿名页面和文件缓冲页面有什么区别？

12、解释下什么是 NUMA？

13、使用哪个命令来查看NUMA信息？

14、/proc/interrupts 文件内容解释？

15、应用程序中怎样将虚拟地址转换为物理地址？

16、简单描述下 /proc/{pid}/pagemap？ -> Q:15

17、为什么malloc的实现中，大于128K的内存使用mmap？

18、什么是内存巨页？相比于传统的页大小有什么优势？

19、简单描述下hugetblfs？

20、怎样查看系统是否开启了巨页？

21、什么是PAE，有什么作用？怎么实现？

22、CPU的 CR3 寄存器存放的是什么？

23、Linux的页表访问分为几个层级？具体实现方式？

24、什么是swap，有什么作用？

25、什么是内存overcommit？

26、系统可配置的处理overcommit策略都有哪些？

27、怎样判断进程有overcommit行为？

28、系统内存空间紧张后的回收策略都有哪些？

29、kswapd 线程有什么作用？

30、什么是同步回收，什么是异步回收？

31、什么情况下会启动kswapd线程？

32、kswapd是否是多线程的？
	(tips：大多数系统上为单线程，但已经有人提出了多线程版本的patch)
	
33、kswapd 消耗CPU过高的问题怎么解决？

34、vm.swapiness 系统参数的作用是？

35、swapoff 和 swapon 命名有什么作用？

36、/proc/sys/vm/drop_caches 传入 1 2 3 分别代表什么？
	(tips：1 表示只回收pageCache，2表示回收dentries和inode，3表示上述两个都回收)	

// 文件系统

1、inode号可以重复吗？

2、不同的文件描述符 怎样可以操作同一文件？

3、简单描述下 ext2 ext3 ext4 文件系统

4、简单描述下 VFS

5、简单描述下 文件系统挂载的实现

6、简单描述下 内核中的文件路径解析

7、bio层的功能简单描述下？

8、什么是超级块？

9、简单描述下 ext2 文件系统支持的最大单个文件大小的算法？（提示：考虑一级间接块，二级间接块，三级间接块）

10、简单描述下 什么是格式化？

11、ext2 使用的块分配算法是什么？ext3 ext4 又是怎么改进的？

12、ext3 和 ext4 通过什么方法提高数据的可靠性的？

13、readahead 的作用是什么？ 简单描述下文件系统预读操作？

14、 pipe 创建的管道在调用exec系列函数后是否仍然可用？

15、 O_CLOSEXEC 标志有什么用？

16、文件的 atime mtime ctime 分别表示什么？

17、怎样获取文件的创建时间？

18、简单描述下inotify机制

19、简单描述下 tail -f 命令的实现？

20、简单描述下电梯调度算法？

21、DIRECT I/O 和 SYNC I/O 的区别是什么？

22、free 命令的显示中 buffer 和 cache 分别代表什么？

23、文件的覆盖写和追加写有什么区别？

24、文件覆盖写时，如果没有进行4096对齐，会产生什么问题？
	（tips：写入时，还要进行剩余数据的读取，造成的一个现象就是写入时伴随着大量的读取操作）

25、文件系统视角下块设备最小操作单位是多少？（以ext文件系统为例）

26、磁盘视角下设备最小操作单位是多少？

27、多个I/O 操作能保证顺序吗？为什么？

28、在采用机械磁盘存储文件时，数据的具体存放位置有什么策略？
	（tips：优先同磁道，其次同柱面，然后就不同磁道了）
	
29、系统启动盘一般在内圈磁道还是外圈磁道，为什么？

30、描述下SSD盘的写入放大问题？

31、ext2文件系统对于目录的组织采用什么数据结构？ext3文件系统呢？为什么？

32、分别描述下RAID1 RAID4 RAID6？分别解决了什么问题？

33、什么是NAS？

34、什么是SAN？

35、什么是SPDK，解决了什么问题？

36、以append标志打开的文件读写是原子的吗？

37、EXT4 的journal 级别有哪些？

38、RAID技术有哪些缺点？

39、影响SSD性能的点都有哪些？

40、SSD有使用预读策略吗？

41、什么是RDMA？在使用中有哪些问题？

42、简单介绍下 RoCE 的实现？

43、SLC MLC TLC 分别表示什么类型的SSD？哪种性能最好？

44、什么是 Open-Channel SSD？

45、什么是文件系统的链式写，什么是扇出写（又叫星型写）？

46、一个进程正在读一个文件，另一个进程删除这个文件，会发生什么？

47、使用 vim或者cat查看文件后，再用 ls -lu 查看文件的atime 并没有改变，为什么？

48、文件系统挂载时的选项 noatime nodiratime 表示什么意思，为什么要这样做？

49、struct file 结构中的 address_space 表示什么？

50、什么是反向映射？解决什么问题？

51、存meta信息的页在 address_space 中吗？

52、task_struct 结构中 prio,static_prio,normal_prio,rt_prio 字段分别表示什么意思？
	（tips：prio表示的是真实的优先级，static_prio和nice的操作关系密切，normal_prio表示的静态优先级的概念，fork时，子进程的static_prio=父进程的normal_prio
	  nice操作通过修改static_prio来影响优先级，进而计算进程对应的weight值，weight值呢又影响了CFS调度中vruntime增加的速度，联想对应PDF中不同nice值的进程
	  的vruntime增长速度图）

53、nice的操作是怎样影响CFS调度器行为的？

54、O_NONBLOCK 标志对普通文件有效果吗？
	（tips：没效果）
	
55、ext2 文件系统的fast symbol link是怎么实现的？

56、readahead 对 dir的影响？

57、ext3 和 ext4 允许的子目录数分别在什么量级？
	(tips：ext3在10k级别，ext4在100k级别)

58、ext4 multi-block allocation、extents和delayed allocation分表表示什么？有什么作用？

59、/proc/$PID/fd 目录下的各个文件表示什么？

60、SSD写入时，采用write back还是write through，为什么？怎么应对掉电？
	(tips：使用write back，SSD本身有大电容，可以保证掉电Cache中数据不丢失)

61、SSD中TRIM指令的作用是？
	(tips：回收不再使用的LBA地址)
	
62、普通文件系统的垃圾回收机制对SSD为什么有时不生效，反而会使得SSD速度变慢？
	(tips：LBA到真正的块地址映射关系和普通机械硬盘不同，将LBA调整为连续可能引起多余的数据擦除和拷贝)
	
63、SSD的预留空间对于文件系统可见吗？
	(tips：不可见，不同厂家的预留空间占总存储比例不同)
	
64、机械硬盘和SSD的Cache采用的是？
	(tips：SRAM)

65、都有哪些常见的zero copy技术？
	(tips：mmap，sendfile)

// 其他

1、内核和用户空间通信都有哪些方法？

2、服务器1U 2U 中的 U 表示什么？
   （tips：U是高度单位，大约 4.45 cm）

3、CDP技术介绍？
   （tips：持续数据持久化，通过内核层的hook来保证数据的安全性）

4、InfiniBand的带宽能达到多少？ Optic Fabric带宽能达到多少？
	(tips：200G，400G)
	
5、什么是 公网下沉？
	(在一台机器上同时部署两张网卡，一张网卡配置公网IP，另一张配置内网ip)
	
6、 SLC MLC TLC QLC 分表表示什么规格的SSD？

7、内核代码可以使用 -O0 编译吗？为什么？
	(tips：代码中内置了一些需要编译优化的代码片段，在-O0级别下编译会报错)
	
8、__attribute__((noinline)) 标识有什么作用？

9、什么是 DAS NAS SAN？

10、IP SAN 的概念？
	(tips：运行iSCSI协议的存储)


// shell
1、怎么样使alias永久生效？

2、source 命令有什么作用？

3、top 命令中CPU使用率高于100，是什么原因？
	(tips：机器有多个core，显示的是各个CPU利用率之和)
	
4、怎样确定一个shell 命令是builtin的？
	(tips：使用type命令查看)
	
5、怎样让系统生成core 文件？
	(tips：ulimit -c unlimited)
	
6、怎样定制core文件命名规则？
	(tips：/proc/sys/kernel/core_pattern)
